import requests
import datetime
from telegram import Update
from telegram.ext import Application, CommandHandler, ContextTypes

# ğŸ” Replace this with your bot token
BOT_TOKEN = "7763698415:AAHl5Q9_a4-KmiXaaMjjzFDuQFNXozDwSPA"

# ğŸ”„ Unix timestamp â¤ Readable string
def timestamp_to_str(ts):
    try:
        return datetime.datetime.fromtimestamp(int(ts)).strftime("%d %B %Y at %H:%M:%S")
    except:
        return "Unknown"

# ğŸ¨ Main formatter function (HTML Styled)
def format_info(data: dict) -> str:
    b = data.get("basicInfo", {})
    s = data.get("socialInfo", {})
    p = data.get("profileInfo", {})
    c = data.get("clanBasicInfo", {})
    pet = data.get("petInfo", {})
    credit = data.get("creditScoreInfo", {})
    leader = data.get("captainBasicInfo", {})

    title_id = {
        904790063: "CS Stormbringer",
        0: "N/A"
    }

    rank_map = {
        300: "Bronze",
        301: "Silver",
        302: "Gold",
        303: "Platinum",
        304: "Diamond",
        305: "Heroic",
        306: "Grandmaster",
        323: "Heroic I",
        324: "Diamond I",
        325: "Diamond II",
        326: "Elite Heroic V"
    }

    return f"""
<b>ğŸ§¾ ACCOUNT INFO:</b><pre>
â”Œ ğŸ‘¤ ACCOUNT BASIC INFO
â”œâ”€ Total Diamonds Topped Up & Claimed: Inactive
â”œâ”€ Prime Level: 1
â”œâ”€ Name: {b.get('nickname')}
â”œâ”€ UID: {b.get('accountId')}
â”œâ”€ Level: {b.get('level')} (Exp: {b.get('exp')})
â”œâ”€ Region: {b.get('region')}
â”œâ”€ Likes: {b.get('liked')}
â”œâ”€ Honor Score: {credit.get('creditScore')}
â”œâ”€ Celebrity Status: False
â”œâ”€ Evo Access Badge: inactive
â”œâ”€ Title ID: {title_id.get(b.get('title'), 'N/A')}
â””â”€ Signature: {s.get('signature', 'None')}

â”Œ ğŸ® ACCOUNT ACTIVITY
â”œâ”€ Most Recent OB: {b.get('releaseVersion')}
â”œâ”€ Fire Pass: Basic
â”œâ”€ Current BP Badges: {b.get('badgeCnt')}
â”œâ”€ BR Rank: {rank_map.get(b.get('rank'), 'Unknown')} ({b.get('rankingPoints')})
â”œâ”€ CS Rank: {rank_map.get(b.get('csRank'), 'Unknown')} ({b.get('csRankingPoints')})
â”œâ”€ Created At: {timestamp_to_str(b.get('createAt'))}
â””â”€ Last Login: {timestamp_to_str(b.get('lastLoginAt'))}

â”Œ ğŸ‘• ACCOUNT OVERVIEW
â”œâ”€ Avatar ID: {b.get('headPic')}
â”œâ”€ Banner ID: 901000035
â”œâ”€ Pin ID: 910040001
â”œâ”€ Equipped Skills: Custom Mapping Needed
â”œâ”€ Equipped Gun ID: {b.get('weaponSkinShows', ['N/A'])[0]}
â”œâ”€ Equipped Animation ID: 912045002
â”œâ”€ Transform Animation ID: Not Equipped
â””â”€ Outfits: Graphically Presented Below! ğŸ˜‰

â”Œ ğŸ¾ PET DETAILS
â”œâ”€ Equipped?: {"Yes" if pet.get("isSelected") else "No"}
â”œâ”€ Pet ID: {pet.get("id")}
â”œâ”€ Pet Exp: {pet.get("exp")}
â””â”€ Pet Level: {pet.get("level")}

â”Œ ğŸ›¡ï¸ GUILD INFO
â”œâ”€ Guild Name: {c.get("clanName", "None")}
â”œâ”€ Guild ID: {c.get("clanId", "None")}
â”œâ”€ Guild Level: {c.get("clanLevel", "None")}
â”œâ”€ Live Members: {c.get("memberNum", "None")}
â””â”€ Leader Info:
    â”œâ”€ Leader Name: {leader.get("nickname")}
    â”œâ”€ Leader UID: {leader.get("accountId")}
    â”œâ”€ Leader Level: {leader.get("level")} (Exp: {leader.get("exp")})
    â”œâ”€ Leader Created At: {timestamp_to_str(leader.get("createAt"))}
    â”œâ”€ Leader Last Login: {timestamp_to_str(leader.get("lastLoginAt"))}
    â”œâ”€ Leader Title ID: Shield Points recovery/sec: 10 â†’ 5
    â”œâ”€ Leader BP Badges: {leader.get("badgeCnt")}
    â”œâ”€ Leader BR: {rank_map.get(leader.get("rank"), 'Unknown')} ({leader.get("rankingPoints")})
    â””â”€ Leader CS: {rank_map.get(leader.get("csRank"), 'Unknown')} ({leader.get("csRankingPoints")})

â”Œ ğŸ—ºï¸ PUBLIC CRAFTLAND MAPS
Not Found

ğŸ“Œ Our Group: https://t.me/coming soon 
ğŸ“Œ Our Channel: https://t.me/coming soon 
ğŸ”— Powered By: @coming soon</pre>
"""

# ğŸ§  /info command handler
async def info_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if len(context.args) != 1:
        await update.message.reply_text("â— Usage: <code>/info &lt;UID&gt;</code>", parse_mode="HTML")
        return

    uid = context.args[0]
    api_url = f"http://full-info.vercel.app/player-info?uid={uid}"

    try:
        response = requests.get(api_url)
        if response.status_code == 200:
            data = response.json()
            msg = format_info(data)
            await update.message.reply_text(msg, parse_mode="HTML")
        else:
            await update.message.reply_text("âŒ Player not found or API error.", parse_mode="HTML")
    except Exception as e:
        await update.message.reply_text(f"ğŸš« Error: <code>{e}</code>", parse_mode="HTML")

# ğŸ”° /start command
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "<b>ğŸ‘‘ WELCOME TO FREE FIRE SBH INFO BOT ğŸ‘‘</b>\n\n"
        "Use <code>/info &lt;uid&gt;</code> to get full profile report.\n\n"
        "ğŸ”¥ Example: <code>/info 3822920378</code>\n\n"
        "ğŸ”— Made with â¤ï¸ by @xsbh_1",
        parse_mode="HTML"
    )

# ğŸš€ Main
def main():
    app = Application.builder().token(BOT_TOKEN).build()
    app.add_handler(CommandHandler("start", start_command))
    app.add_handler(CommandHandler("info", info_command))
    print("âœ… BOT IS RUNNING...")
    app.run_polling()

if __name__ == "__main__":
    main()
